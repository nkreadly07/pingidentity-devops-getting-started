
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://devops.pingidentity.com/deployment/deployK8sPD-clusters/">
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.3">
    
    
      
        <title>PingDirectory Deployments Across Kubernetes Clusters - Ping Identity DevOps</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4a0965b7.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../mkdocs/overrides/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pingdirectory-deployments-across-kubernetes-clusters" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Ping Identity DevOps" class="md-header__button md-logo" aria-label="Ping Identity DevOps" data-md-component="logo">
      <!-- Logo -->
  
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ping Identity DevOps
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PingDirectory Deployments Across Kubernetes Clusters
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pingidentity/pingidentity-devops-getting-started" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pingidentity/pingidentity-devops-getting-started
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        DevOps @ Ping
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../get-started/getStarted/" class="md-tabs__link">
        Get Started
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../deploy/" class="md-tabs__link md-tabs__link--active">
        Deployment
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../how-to/existingLicense/" class="md-tabs__link">
        How To
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/config/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../release-notes/currentRelease/" class="md-tabs__link">
        Release Notes
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Ping Identity DevOps" class="md-nav__button md-logo" aria-label="Ping Identity DevOps" data-md-component="logo">
      <!-- Logo -->
  
    </a>
    Ping Identity DevOps
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pingidentity/pingidentity-devops-getting-started" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pingidentity/pingidentity-devops-getting-started
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          DevOps @ Ping
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DevOps @ Ping" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          DevOps @ Ping
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../supportPolicy/" class="md-nav__link">
        Support Policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../disclaimer/" class="md-nav__link">
        Disclaimer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../3rdPartySoftware/" class="md-nav__link">
        Third-Party Software
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Get Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Get Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Get Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/getStarted/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/devopsRegistration/" class="md-nav__link">
        DevOps Registration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/pingctlUtil/" class="md-nav__link">
        pingctl Utility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/devopsUserKey/" class="md-nav__link">
        Using Your DevOps User and Key
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/configVars/" class="md-nav__link">
        Configure Your Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/prodLicense/" class="md-nav__link">
        DevOps Product Licenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/getStartedWithGitRepo/" class="md-nav__link">
        Deploy Example Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/k8sBasics/" class="md-nav__link">
        Kubernetes Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/HelmBasics/" class="md-nav__link">
        Helm Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/pingone-config/" class="md-nav__link">
        PingOne  Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/pingDevopsUtil_Deprecated/" class="md-nav__link">
        ping-devops Utility (Deprecated)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploy/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Deploy with Docker-Compose
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deploy with Docker-Compose" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Deploy with Docker-Compose
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployCompose/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploySimpleStack/" class="md-nav__link">
        Deploy PingFederate and PingDirectory Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployReplication/" class="md-nav__link">
        Deploy Replicated PingDirectory Pair
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploySync/" class="md-nav__link">
        Deploy PingDirectory and PingDataSync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploySyncFailover/" class="md-nav__link">
        Deploy PingDataSync Failover Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPingDataConsoleSSO/" class="md-nav__link">
        Deploy PingDataConsole with PingOne SSO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPingCentral/" class="md-nav__link">
        Deploy PingCentral
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPfCluster/" class="md-nav__link">
        Deploy PingFederate Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPaCluster/" class="md-nav__link">
        Deploy PingAccess Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPazPap/" class="md-nav__link">
        Deploy PingAuthorize with the Policy Editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployMonitoringStack/" class="md-nav__link">
        Deploy Monitoring Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploySiemStack/" class="md-nav__link">
        Deploy an Elasticsearch SIEM Stack
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Deploy with Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deploy with Kubernetes" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Deploy with Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8s/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../environmentConsiderations/" class="md-nav__link">
        Environment considerations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployLocalK8sCluster/" class="md-nav__link">
        Deploy Local Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployHelm/" class="md-nav__link">
        Deploy with Ping Identity Helm Charts
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          PingDirectory Deployments Across Kubernetes Clusters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        PingDirectory Deployments Across Kubernetes Clusters
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-pingdirectory-clusters" class="md-nav__link">
    About PingDirectory clusters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pingdirectory-host-naming" class="md-nav__link">
    PingDirectory Host Naming
  </a>
  
    <nav class="md-nav" aria-label="PingDirectory Host Naming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-cluster-multiple-namespace" class="md-nav__link">
    Single-Cluster Multiple-Namespace
  </a>
  
    <nav class="md-nav" aria-label="Single-Cluster Multiple-Namespace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary-cluster" class="md-nav__link">
    Primary Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary-cluster" class="md-nav__link">
    Secondary Cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-dns-names" class="md-nav__link">
    External DNS Names
  </a>
  
    <nav class="md-nav" aria-label="External DNS Names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#us-west-cluster" class="md-nav__link">
    us-west cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#us-east-cluster" class="md-nav__link">
    us-east cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-to-create-hostnames" class="md-nav__link">
    Variables to Create Hostnames
  </a>
  
    <nav class="md-nav" aria-label="Variables to Create Hostnames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-previous-hostname-examples" class="md-nav__link">
    Using Previous Hostname Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-startup-walkthrough" class="md-nav__link">
    Cluster Startup Walkthrough
  </a>
  
    <nav class="md-nav" aria-label="Cluster Startup Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note-on-replication-traffic" class="md-nav__link">
    Note on Replication Traffic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-modes-of-deployment" class="md-nav__link">
    Reference Modes of Deployment
  </a>
  
    <nav class="md-nav" aria-label="Reference Modes of Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-cluster-simulations" class="md-nav__link">
    Multi-cluster Simulations
  </a>
  
    <nav class="md-nav" aria-label="Multi-cluster Simulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-namespace" class="md-nav__link">
    Single Namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-cluster-multiple-namespaces" class="md-nav__link">
    Single Cluster Multiple Namespaces
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-peered-k8s-clusters" class="md-nav__link">
    VPC Peered K8s Clusters
  </a>
  
    <nav class="md-nav" aria-label="VPC Peered K8s Clusters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-external-dns-names" class="md-nav__link">
    Using External DNS Names
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#without-vpc-peering" class="md-nav__link">
    Without VPC Peering
  </a>
  
    <nav class="md-nav" aria-label="Without VPC Peering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-nodeports" class="md-nav__link">
    Using NodePorts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-load-balancer" class="md-nav__link">
    Single Load Balancer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-load-balancers" class="md-nav__link">
    Multiple Load Balancers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statefulset-pod-services" class="md-nav__link">
    StatefulSet Pod Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-kubernetes-resources-required" class="md-nav__link">
    Additional Kubernetes Resources Required
  </a>
  
    <nav class="md-nav" aria-label="Additional Kubernetes Resources Required">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-ingress-service-and-controller" class="md-nav__link">
    NGINX Ingress Service and Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-tcp-services" class="md-nav__link">
    NGINX TCP Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-example" class="md-nav__link">
    Deployment Example
  </a>
  
    <nav class="md-nav" aria-label="Deployment Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-yaml-for-us-east-2" class="md-nav__link">
    Creating .yaml for us-east-2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_6" type="checkbox" id="__nav_3_3_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3_6">
          Kubernetes Deployments For General Use
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes Deployments For General Use" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_6">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes Deployments For General Use
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sGeneral/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sStandalone/" class="md-nav__link">
        Orchestrate Standalone Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sFullstack/" class="md-nav__link">
        Orchestrate a Full Stack Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sReplicated/" class="md-nav__link">
        Orchestrate a Replicated PingDirectory Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sPA-cluster/" class="md-nav__link">
        Orchestrate a PingAccess Cluster Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sPF-cluster/" class="md-nav__link">
        Orchestrate a PingFederate Cluster Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_6_7" type="checkbox" id="__nav_3_3_6_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3_6_7">
          Deploy PingFederate Across Multiple Kubernetes Clusters
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deploy PingFederate Across Multiple Kubernetes Clusters" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_3_6_7">
          <span class="md-nav__icon md-icon"></span>
          Deploy PingFederate Across Multiple Kubernetes Clusters
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sPFclusters/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pfMultiRegionAWSPrereq/" class="md-nav__link">
        AWS Multi-Region Prereq
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPFMultiRegionDNS/" class="md-nav__link">
        PingFederate Across Kubernetes with DNS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployPFMultiRegionAWS/" class="md-nav__link">
        PingFederate Across Kubernetes with S3
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_7" type="checkbox" id="__nav_3_3_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3_7">
          Kubernetes Deployments For Cloud Platforms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes Deployments For Cloud Platforms" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_7">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes Deployments For Cloud Platforms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sCloud/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8s-AWS/" class="md-nav__link">
        Deploy Peered EKS Clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8s-AKS/" class="md-nav__link">
        Deploy to Azure Kubernetes Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../k8sClusterSizing/" class="md-nav__link">
        Sizing Kubernetes Clusters
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployVault/" class="md-nav__link">
        Deploy Hashicorp Vault
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sClusterMetrics/" class="md-nav__link">
        Deploy a Monitoring Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployK8sUtilitySidecar/" class="md-nav__link">
        Deploy a Utility Sidecar
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Operating Patterns
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Operating Patterns" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Operating Patterns
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploymentPatterns/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../managePingFederate/" class="md-nav__link">
        PingFederate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          How To
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="How To" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          How To
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/existingLicense/" class="md-nav__link">
        Use Existing Licenses
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Server Profile
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Server Profile" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Server Profile
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/containerAnatomy/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/profiles/" class="md-nav__link">
        Customization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/saveConfigs/" class="md-nav__link">
        Saving Configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_4" type="checkbox" id="__nav_4_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_4">
          Build Your Own
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Build Your Own" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_4">
          <span class="md-nav__icon md-icon"></span>
          Build Your Own
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/buildPingFederateProfile/" class="md-nav__link">
        PingFederate Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/buildPingDirectoryProfile/" class="md-nav__link">
        PingDirectory Profile
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/profilesLayered/" class="md-nav__link">
        Layering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/profilesSubstitution/" class="md-nav__link">
        ENV Substitution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/privateRepos/" class="md-nav__link">
        Private Github Repos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/usingVault/" class="md-nav__link">
        Vault/Secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/secureContainers/" class="md-nav__link">
        Securing the Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_5">
          Upgrading Deployments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Upgrading Deployments" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Upgrading Deployments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/manage/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/upgradePingfederate/" class="md-nav__link">
        Upgrading PingFederate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/upgradePingDirectory/" class="md-nav__link">
        Upgrading PingDirectory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to/migratingRootToUnprivileged/" class="md-nav__link">
        Migrating to Unprivileged Images
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/config/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/profileStructures/" class="md-nav__link">
        Server Profile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/yamlFiles/" class="md-nav__link">
        Docker Compose YAML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/variableScoping/" class="md-nav__link">
        Variables and Scope
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/usingCertificates/" class="md-nav__link">
        Certificates
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_6" type="checkbox" id="__nav_5_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_6">
          Image Info
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Info" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Image Info
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/releaseTags/" class="md-nav__link">
        Release Tags
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/productVersionMatrix/" class="md-nav__link">
        Product & Image Release Matrix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/imageSupport/" class="md-nav__link">
        Docker Image Support Policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dockerImageSecurity/" class="md-nav__link">
        DevOps Image Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_7" type="checkbox" id="__nav_5_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_7">
          Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utilities" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_7">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ldapsdkUtil/" class="md-nav__link">
        ldap-sdk-tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/faqs/" class="md-nav__link">
        FAQs
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_10" type="checkbox" id="__nav_5_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_10">
          DevOps Images Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DevOps Images Reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_10">
          <span class="md-nav__icon md-icon"></span>
          DevOps Images Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dockerImagesRef/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingaccess/" class="md-nav__link">
        PingAccess
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingauthorize/" class="md-nav__link">
        PingAuthorize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingauthorizepap/" class="md-nav__link">
        PingAuthorize PAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingbase/" class="md-nav__link">
        PingBase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingcentral/" class="md-nav__link">
        PingCentral
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingcommon/" class="md-nav__link">
        PingCommon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdatacommon/" class="md-nav__link">
        PingDataCommon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdataconsole/" class="md-nav__link">
        PingDataConsole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdatagovernance/" class="md-nav__link">
        PingDataGovernance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdatagovernancepap/" class="md-nav__link">
        PingDataGovernance PAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdatasync/" class="md-nav__link">
        PingDataSync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdelegator/" class="md-nav__link">
        PingDelegator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdirectory/" class="md-nav__link">
        PingDirectory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdirectoryproxy/" class="md-nav__link">
        PingDirectoryProxy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingdownloader/" class="md-nav__link">
        PingDownloader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingfederate/" class="md-nav__link">
        PingFederate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingintelligence/" class="md-nav__link">
        PingIntelligence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/pingtoolkit/" class="md-nav__link">
        PingToolkit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/apache-jmeter/" class="md-nav__link">
        Apache JMeter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../docker-images/ldap-sdk-tools/" class="md-nav__link">
        ldap-sdk-tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_11" type="checkbox" id="__nav_5_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_11">
          Advanced Topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced Topics" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_11">
          <span class="md-nav__icon md-icon"></span>
          Advanced Topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/hooks/" class="md-nav__link">
        DevOps Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/addMOTD/" class="md-nav__link">
        Adding a MOTD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/buildLocal/" class="md-nav__link">
        Build Local Images
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Release Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Release Notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Release Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/currentRelease/" class="md-nav__link">
        Current Release
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          All Releases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="All Releases" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          All Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2205/" class="md-nav__link">
        Version 2205
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2204/" class="md-nav__link">
        Version 2204
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2203/" class="md-nav__link">
        Version 2203
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2202/" class="md-nav__link">
        Version 2202
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2201/" class="md-nav__link">
        Version 2201
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2112/" class="md-nav__link">
        Version 2112
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2111-1/" class="md-nav__link">
        Version 2111.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2111/" class="md-nav__link">
        Version 2111
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2110/" class="md-nav__link">
        Version 2110
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2109/" class="md-nav__link">
        Version 2109
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2108/" class="md-nav__link">
        Version 2108
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2107/" class="md-nav__link">
        Version 2107
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2106/" class="md-nav__link">
        Version 2106
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2105/" class="md-nav__link">
        Version 2105
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2104/" class="md-nav__link">
        Version 2104
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2103/" class="md-nav__link">
        Version 2103
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2102/" class="md-nav__link">
        Version 2102
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2101/" class="md-nav__link">
        Version 2101
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2012/" class="md-nav__link">
        Version 2012
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2011/" class="md-nav__link">
        Version 2011
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2010/" class="md-nav__link">
        Version 2010
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2009/" class="md-nav__link">
        Version 2009
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2008/" class="md-nav__link">
        Version 2008
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2007/" class="md-nav__link">
        Version 2007
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2006/" class="md-nav__link">
        Version 2006
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2005/" class="md-nav__link">
        Version 2005
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2004/" class="md-nav__link">
        Version 2004
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/relnotes-2003/" class="md-nav__link">
        Version 2003
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-pingdirectory-clusters" class="md-nav__link">
    About PingDirectory clusters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pingdirectory-host-naming" class="md-nav__link">
    PingDirectory Host Naming
  </a>
  
    <nav class="md-nav" aria-label="PingDirectory Host Naming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-cluster-multiple-namespace" class="md-nav__link">
    Single-Cluster Multiple-Namespace
  </a>
  
    <nav class="md-nav" aria-label="Single-Cluster Multiple-Namespace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primary-cluster" class="md-nav__link">
    Primary Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary-cluster" class="md-nav__link">
    Secondary Cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-dns-names" class="md-nav__link">
    External DNS Names
  </a>
  
    <nav class="md-nav" aria-label="External DNS Names">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#us-west-cluster" class="md-nav__link">
    us-west cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#us-east-cluster" class="md-nav__link">
    us-east cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-to-create-hostnames" class="md-nav__link">
    Variables to Create Hostnames
  </a>
  
    <nav class="md-nav" aria-label="Variables to Create Hostnames">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-previous-hostname-examples" class="md-nav__link">
    Using Previous Hostname Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-startup-walkthrough" class="md-nav__link">
    Cluster Startup Walkthrough
  </a>
  
    <nav class="md-nav" aria-label="Cluster Startup Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note-on-replication-traffic" class="md-nav__link">
    Note on Replication Traffic
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-modes-of-deployment" class="md-nav__link">
    Reference Modes of Deployment
  </a>
  
    <nav class="md-nav" aria-label="Reference Modes of Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-cluster-simulations" class="md-nav__link">
    Multi-cluster Simulations
  </a>
  
    <nav class="md-nav" aria-label="Multi-cluster Simulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-namespace" class="md-nav__link">
    Single Namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-cluster-multiple-namespaces" class="md-nav__link">
    Single Cluster Multiple Namespaces
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-peered-k8s-clusters" class="md-nav__link">
    VPC Peered K8s Clusters
  </a>
  
    <nav class="md-nav" aria-label="VPC Peered K8s Clusters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-external-dns-names" class="md-nav__link">
    Using External DNS Names
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#without-vpc-peering" class="md-nav__link">
    Without VPC Peering
  </a>
  
    <nav class="md-nav" aria-label="Without VPC Peering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-nodeports" class="md-nav__link">
    Using NodePorts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-load-balancer" class="md-nav__link">
    Single Load Balancer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-load-balancers" class="md-nav__link">
    Multiple Load Balancers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statefulset-pod-services" class="md-nav__link">
    StatefulSet Pod Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-kubernetes-resources-required" class="md-nav__link">
    Additional Kubernetes Resources Required
  </a>
  
    <nav class="md-nav" aria-label="Additional Kubernetes Resources Required">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    DNS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-ingress-service-and-controller" class="md-nav__link">
    NGINX Ingress Service and Controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-tcp-services" class="md-nav__link">
    NGINX TCP Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-example" class="md-nav__link">
    Deployment Example
  </a>
  
    <nav class="md-nav" aria-label="Deployment Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-yaml-for-us-east-2" class="md-nav__link">
    Creating .yaml for us-east-2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="pingdirectory-deployments-across-kubernetes-clusters">PingDirectory Deployments Across Kubernetes Clusters<a class="headerlink" href="#pingdirectory-deployments-across-kubernetes-clusters" title="Permanent link"> </a></h1>
<p>The following example is an extension of the topic <em>Orchestrating a replicated PingDirectory deployment</em> in <a href="../deployK8sGeneral/">Kubernetes orchestration for general use</a>. In this example, you'll deploy PingDirectory containers across multiple Kubernetes clusters.</p>
<p><img alt="K8S Multi-Cluster Overview" src="../../images/multi-k8s-cluster-pingdirectory-overview.png" /></p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link"> </a></h2>
<p>Having a replicated PingDirectory topology across multiple kubernetes clusters is desired for highly-available active/active deployments as well as active/partial-active scenarios where a hot backup is expected.</p>
<p>Ping Identity PingDirectory Docker images abstract away much of the complexity of replication initialization scripts, even across clusters. Instead, the focus is on
providing accessible DNS hostnames across clusters and environment variables to build ordinal hostnames for each Directory instance.</p>
<h3 id="about-pingdirectory-clusters">About PingDirectory clusters<a class="headerlink" href="#about-pingdirectory-clusters" title="Permanent link"> </a></h3>
<p>You will need the following:</p>
<ol>
<li><a href="#pingdirectory-host-naming">PingDirectory Container Keys To Success</a>.</li>
<li><a href="#variables-to-create-hostnames">Draft Hostnames</a> - Determine the variables needed to create your hostnames.</li>
<li><a href="#environment-variables">Additional Variables</a> - Use these variables for use-case flexibility.</li>
<li><a href="#cluster-startup-walkthrough">Cluster Startup Background</a> - Walk through what happens when a cluster starts.</li>
<li><a href="#reference-modes-of-deployment">Design Infrastructure to Match Hostnames</a> - Based on your infrastructure constraints, you might need to alter your hostname plans. Use these reference examples to help.</li>
<li><code>11-replication-timing</code> - Use this folder to test replication speeds in the deployment.</li>
</ol>
<p>Because details within each Kubernetes cluster are well-hidden from outside the cluster, external access to each pod within the cluster is required. The PingDirectory images set up access to each of the pods using load balancers from an external host to allow each pod to communicate over the LDAP and replication protocols.</p>
<h2 id="pingdirectory-host-naming">PingDirectory Host Naming<a class="headerlink" href="#pingdirectory-host-naming" title="Permanent link"> </a></h2>
<p>The most important aspect of a successful PingDirectory cross-cluster deployment assigning accessible and logical DNS hostnames according to the following rules:</p>
<ol>
<li>Each PingDirectory needs its own hostname available in DNS.</li>
<li>The hostname has a space for the ordinal representing the instance in the <code>statefulset</code>.</li>
<li>All hostnames are accessible to all directory instances.</li>
</ol>
<p>These rules still leave plenty of room for flexibility, especially when accounting for cluster-native DNS names Kubernetes creates.</p>
<h3 id="single-cluster-multiple-namespace">Single-Cluster Multiple-Namespace<a class="headerlink" href="#single-cluster-multiple-namespace" title="Permanent link"> </a></h3>
<p>If you were to simulate a "multi-cluster" environment in a single cluster, you could just set up two namespaces and create a separate ClusterIP service for each directory, as follows:</p>
<h4 id="primary-cluster">Primary Cluster<a class="headerlink" href="#primary-cluster" title="Permanent link"> </a></h4>
<table>
<thead>
<tr>
<th>Pod</th>
<th>Service Name</th>
<th>Namespace</th>
<th>Hostname</th>
</tr>
</thead>
<tbody>
<tr>
<td>pindirectory-0</td>
<td>pingdirectory-0</td>
<td>primary</td>
<td>pingdirectory-0.primary</td>
</tr>
<tr>
<td>pindirectory-1</td>
<td>pingdirectory-1</td>
<td>primary</td>
<td>pingdirectory-1.primary</td>
</tr>
<tr>
<td>pindirectory-2</td>
<td>pingdirectory-2</td>
<td>primary</td>
<td>pingdirectory-2.primary</td>
</tr>
</tbody>
</table>
<h4 id="secondary-cluster">Secondary Cluster<a class="headerlink" href="#secondary-cluster" title="Permanent link"> </a></h4>
<table>
<thead>
<tr>
<th>Pod</th>
<th>Service Name</th>
<th>Namespace</th>
<th>Hostname</th>
</tr>
</thead>
<tbody>
<tr>
<td>pindirectory-0</td>
<td>pingdirectory-0</td>
<td>secondary</td>
<td>pingdirectory-0.secondary</td>
</tr>
<tr>
<td>pindirectory-1</td>
<td>pingdirectory-1</td>
<td>secondary</td>
<td>pingdirectory-1.secondary</td>
</tr>
<tr>
<td>pindirectory-2</td>
<td>pingdirectory-2</td>
<td>secondary</td>
<td>pingdirectory-2.secondary</td>
</tr>
</tbody>
</table>
<h3 id="external-dns-names">External DNS Names<a class="headerlink" href="#external-dns-names" title="Permanent link"> </a></h3>
<p>In a Prod Environment with external hostnames, it might look more like:</p>
<h4 id="us-west-cluster">us-west cluster<a class="headerlink" href="#us-west-cluster" title="Permanent link"> </a></h4>
<table>
<thead>
<tr>
<th>Pod</th>
<th>Service Name</th>
<th>DNS / Hostname</th>
</tr>
</thead>
<tbody>
<tr>
<td>pindirectory-0</td>
<td>pingdirectory-0</td>
<td>pingdirectory-0-us-west.ping-devops.com</td>
</tr>
<tr>
<td>pindirectory-1</td>
<td>pingdirectory-1</td>
<td>pingdirectory-1-us-west.ping-devops.com</td>
</tr>
<tr>
<td>pindirectory-2</td>
<td>pingdirectory-2</td>
<td>pingdirectory-2-us-west.ping-devops.com</td>
</tr>
</tbody>
</table>
<h4 id="us-east-cluster">us-east cluster<a class="headerlink" href="#us-east-cluster" title="Permanent link"> </a></h4>
<table>
<thead>
<tr>
<th>Pod</th>
<th>Service Name</th>
<th>DNS / Hostname</th>
</tr>
</thead>
<tbody>
<tr>
<td>pindirectory-0</td>
<td>pingdirectory-0</td>
<td>pingdirectory-0-us-east.ping-devops.com</td>
</tr>
<tr>
<td>pindirectory-1</td>
<td>pingdirectory-1</td>
<td>pingdirectory-1-us-east.ping-devops.com</td>
</tr>
<tr>
<td>pindirectory-2</td>
<td>pingdirectory-2</td>
<td>pingdirectory-2-us-east.ping-devops.com</td>
</tr>
</tbody>
</table>
<h2 id="variables-to-create-hostnames">Variables to Create Hostnames<a class="headerlink" href="#variables-to-create-hostnames" title="Permanent link"> </a></h2>
<p>To provide flexibility on how PingDirectory finds other instances, a full DNS hostname is broken into multiple variables.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>K8S_POD_HOSTNAME_PREFIX</code></td>
<td>The string used as the prefix for all host names.  Defaults to name of <code>StatefulSet</code>.</td>
</tr>
<tr>
<td><code>K8S_POD_HOSTNAME_SUFFIX</code></td>
<td>The string used as the suffix for all pod host names.  Defaults to <code>K8S_CLUSTER</code>.</td>
</tr>
<tr>
<td><code>K8S_SEED_HOSTNAME_PREFIX</code></td>
<td>The string used as the prefix for all seed host names.  Defaults to <code>K8S_POD_HOSTNAME_PREFIX</code>.</td>
</tr>
<tr>
<td><code>K8S_SEED_HOSTNAME_SUFFIX</code></td>
<td>The string used as the suffix for all seed host names.  Defaults to <code>K8S_SEED_CLUSTER</code> (discussed later).</td>
</tr>
</tbody>
</table>
<p>A full hostname is created using the following command:</p>
<div class="highlight"><pre><span></span><code><span class="si">${</span><span class="nv">K8S_POD_HOSTNAME_PREFIX</span><span class="si">}</span>&lt;instance-ordinal&gt;<span class="si">${</span><span class="nv">K8S_SEED_HOSTNAME_SUFFIX</span><span class="si">}</span>
</code></pre></div>
<h3 id="using-previous-hostname-examples">Using Previous Hostname Examples<a class="headerlink" href="#using-previous-hostname-examples" title="Permanent link"> </a></h3>
<p>| hostname | K8S_POD_HOSTNAME_PREFIX | K8S_SEED_HOSTNAME_PREFIX | K8S_POD_HOSTNAME_SUFFIX | K8S_SEED_HOSTNAME_SUFFIX |
|---|:---:|---|---|
| pingdirectory-0.primary|<code>pingdirectory-</code>| <code>pingdirectory-</code>| <code>.primary</code>|<code>.primary</code>|
| pingdirectory-2-us-west.ping-devops.com| <code>pingdirectory-</code>| <code>pingdirectory-</code>| <code>-us-west.ping-devops.com</code>|<code>-us-west.ping-devops.com</code>|</p>
<h2 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link"> </a></h2>
<table>
<thead>
<tr>
<th>Variable</th>
<th align="center">Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>K8S_CLUSTERS</code></td>
<td align="center">***</td>
<td>The total list of Kubernetes clusters that the <code>StatefulSet</code> replicates to.</td>
</tr>
<tr>
<td><code>K8S_CLUSTER</code></td>
<td align="center">***</td>
<td>The Kubernetes cluster the <code>StatefulSet</code> is deployed to.</td>
</tr>
<tr>
<td><code>K8S_SEED_CLUSTER</code></td>
<td align="center">***</td>
<td>The Kubernetes cluster that the seed server is deployed to.</td>
</tr>
<tr>
<td><code>K8S_NUM_REPLICAS</code></td>
<td align="center"></td>
<td>The number of replicas that make up the <code>StatefulSet</code>.</td>
</tr>
<tr>
<td><code>K8S_POD_HOSTNAME_PREFIX</code></td>
<td align="center"></td>
<td>The string used as the prefix for all host names.  Defaults to <code>StatefulSet</code>.</td>
</tr>
<tr>
<td><code>K8S_POD_HOSTNAME_SUFFIX</code></td>
<td align="center"></td>
<td>The string used as the suffix for all pod host names.  Defaults to <code>K8S_CLUSTER</code>.</td>
</tr>
<tr>
<td><code>K8S_SEED_HOSTNAME_PREFIX</code></td>
<td align="center"></td>
<td>The string used as the prefix for all seed host names.  Defaults to <code>K8S_POD_HOSTNAME_PREFIX</code>.</td>
</tr>
<tr>
<td><code>K8S_SEED_HOSTNAME_SUFFIX</code></td>
<td align="center"></td>
<td>The string used as the suffix for all seed host names.  Defaults to <code>K8S_SEED_CLUSTER</code>.</td>
</tr>
<tr>
<td><code>K8S_INCREMENT_PORTS</code></td>
<td align="center"></td>
<td><code>true</code> or <code>false</code>.  If <code>true</code>, each pod's port will be incremented by 1.</td>
</tr>
</tbody>
</table>
<p>An example of the YAML configuration for these environment variables:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">K8S_STATEFUL_SET_NAME=pingdirectory</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">K8S_STATEFUL_SET_SERVICE_NAME=pingdirectory</span><span class="w"></span>

<span class="l l-Scalar l-Scalar-Plain">K8S_CLUSTERS=us-east-2 eu-west-1</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">K8S_CLUSTER=us-east-2</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">K8S_SEED_CLUSTER=us-east-2</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">K8S_NUM_REPLICAS=3</span><span class="w"></span>

<span class="l l-Scalar l-Scalar-Plain">K8S_POD_HOSTNAME_PREFIX=pd-</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">K8S_POD_HOSTNAME_SUFFIX=.us-cluster.ping-devops.com</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">K8S_SEED_HOSTNAME_PREFIX=pd-</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">K8S_SEED_HOSTNAME_SUFFIX=.us-cluster.ping-devops.com</span><span class="w"></span>

<span class="l l-Scalar l-Scalar-Plain">K8S_INCREMENT_PORTS=true</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">LDAPS_PORT=8600</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">REPLICATION_PORT=8700</span><span class="w"></span>
</code></pre></div>
<p>These environment variable settings would map out as follows:</p>
<table>
<thead>
<tr>
<th align="center">Seed</th>
<th align="center">Pod</th>
<th>Instance</th>
<th>Host name</th>
<th align="center">LDAP</th>
<th align="center">REPL</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"></td>
<td align="center"></td>
<td>CLUSTER: us-east-2</td>
<td></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">***</td>
<td align="center">***</td>
<td>pingdirectory-0.us-east-2</td>
<td>pd-0.us-cluster.ping-devops.com</td>
<td align="center">8600</td>
<td align="center">8700</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td>pingdirectory-1.us-east-2</td>
<td>pd-1.us-cluster.ping-devops.com</td>
<td align="center">8601</td>
<td align="center">8701</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td>pingdirectory-2.us-east-2</td>
<td>pd-2.us-cluster.ping-devops.com</td>
<td align="center">8602</td>
<td align="center">8702</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td>CLUSTER: eu-west-1</td>
<td></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td>pingdirectory-0.eu-west-1</td>
<td>pd-0.eu-cluster.ping-devops.com</td>
<td align="center">8600</td>
<td align="center">8700</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td>pingdirectory-1.eu-west-1</td>
<td>pd-1.eu-cluster.ping-devops.com</td>
<td align="center">8601</td>
<td align="center">8701</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td>pingdirectory-2.eu-west-1</td>
<td>pd-2.eu-cluster.ping-devops.com</td>
<td align="center">8602</td>
<td align="center">8702</td>
</tr>
</tbody>
</table>
<h2 id="cluster-startup-walkthrough">Cluster Startup Walkthrough<a class="headerlink" href="#cluster-startup-walkthrough" title="Permanent link"> </a></h2>
<p>This in-depth variable conversation offers the flexibility to accommodate various infrastructure constraints. For example, in some environments, you can't use the same port for each instance, so we must accommodate incrementing ports.</p>
<p>To understand why the initial creation of a cluster requires a prescriptive approach, it's helpful to know what happens when a cluster starts.</p>
<ol>
<li>The first pod must start on its own and become healthy. This is critical to prevent replication islands. The first time the first pod starts, we call it "GENESIS". All other pods are dependent on this <code>SEED_POD</code> in the <code>SEED_CLUSTER</code> starting correctly on its own. The entire purpose of defining <code>SEED_POD</code> and <code>SEED_CLUSTER</code> variables is to avoid multiple genesis scenarios.</li>
</ol>
<blockquote>
<p>Because we're deploying a <code>statefulset</code>, you can deploy the entire first cluster at once. A <code>statefulset</code> creates one pod in the number of replicas at a time.</p>
</blockquote>
<ol>
<li>When the first pod is healthy, it begins DNS querying combinations of hostnames at their LDAPS port to find another Directory instance.</li>
</ol>
<p>In our first cluster, this would be the hostname of <code>pingdirectory-1</code>. but it could also be <code>pingdirectory-0</code> of another cluster. When the query returns successful, creation of the replication topology automatically begins.</p>
<ol>
<li>From this point onward, the order in which instances start is less important.</li>
</ol>
<h3 id="note-on-replication-traffic">Note on Replication Traffic<a class="headerlink" href="#note-on-replication-traffic" title="Permanent link"> </a></h3>
<p>It might not always be clear what truly happens during "replication". Though it is partially proprietary, you can think of it as:</p>
<ol>
<li>
<p>A modify request arrives at one pod.</p>
</li>
<li>
<p>The corresponding Directory instance, say <code>pingdirectory-0</code>, makes the change locally and tracks the change in the changelog.</p>
</li>
<li>
<p>The instance broadcasts the change out to all other instances with the time of change. This request is added to a message queue of sorts on the other instances and processed in order.</p>
</li>
</ol>
<p>Because of this, horizontal scaling of directories isn't something to be taken lightly.</p>
<h2 id="reference-modes-of-deployment">Reference Modes of Deployment<a class="headerlink" href="#reference-modes-of-deployment" title="Permanent link"> </a></h2>
<p>There are multiple types of deployments that have been tested because of various infrastructure constraints discussed in this guide. The example files in <code>09-multi-k8s-pingdirectory</code> show that the biggest key is having a way to provide an accessible hostname to all the other pods. In most examples, you do this by creating a service name and using <code>statefulset.kubernetes.io/pod-name</code> as the selector to isolate one pod.</p>
<h3 id="multi-cluster-simulations">Multi-cluster Simulations<a class="headerlink" href="#multi-cluster-simulations" title="Permanent link"> </a></h3>
<p>These are examples for demo environments to get a feel for what a multi-region deployment looks like.</p>
<h4 id="single-namespace">Single Namespace<a class="headerlink" href="#single-namespace" title="Permanent link"> </a></h4>
<p><code>20-kustomize/09-multi-k8s-pingdirectory/01-single-namespace</code> is the least constrained example. It's good to just see what logs on a cross-cluster topology look like:</p>
<ul>
<li>Relies only on DNS names that kubernetes provides.</li>
<li>All traffic is in one namespace, so it should have no network constraints.</li>
</ul>
<div class="highlight"><pre><span></span><code>kubectl apply -f <span class="m">01</span>-west.yaml
</code></pre></div>
<ol>
<li>Wait for <code>pingdirectory-0</code> to be healthy.</li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl apply -f <span class="m">02</span>-east.yaml
</code></pre></div>
<blockquote>
<p>Note, logs with <a href="https://github.com/wercker/stern">stern</a> look better.
 <code>brew install stern</code></p>
</blockquote>
<ol>
<li>
<p>Watch the logs.</p>
<div class="highlight"><pre><span></span><code>stern pingdirectory
</code></pre></div>
</li>
</ol>
<p>or</p>
<p><code>sh
   kubectl logs -f -l role=pingdirectory</code></p>
<p>When the all the instances are up and running, you should see something similar to:</p>
<p><img alt="single-ns-cluster-logs" src="../../images/pd-multi-single-ns.png" /></p>
<h4 id="single-cluster-multiple-namespaces">Single Cluster Multiple Namespaces<a class="headerlink" href="#single-cluster-multiple-namespaces" title="Permanent link"> </a></h4>
<p><code>20-kustomize/09-multi-k8s-pingdirectory/02-single-cluster-two-namespaces</code></p>
<ol>
<li>
<p>Use this example when you only have one cluster available for testing.</p>
<p>The files in this example are templates and expect namespaces to be added.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">NAMESPACE_1</span><span class="o">=</span>&lt;west-namespace&gt;
<span class="nb">export</span> <span class="nv">NAMESPACE_2</span><span class="o">=</span>&lt;east-namespace&gt;
envsubst &lt; <span class="m">03</span>-multi-cluster-dns/01-west.yaml <span class="p">|</span> kubectl apply -f -
envsubst &lt; <span class="m">03</span>-multi-cluster-dns/02-east.yaml <span class="p">|</span> kubectl apply -f -
</code></pre></div>
</li>
<li>
<p>Watch logs.</p>
</li>
</ol>
<h3 id="vpc-peered-k8s-clusters">VPC Peered K8s Clusters<a class="headerlink" href="#vpc-peered-k8s-clusters" title="Permanent link"> </a></h3>
<p>These example should be possible in most Kubernetes providers as long as you can:</p>
<ul>
<li>Give external dns names to clusterIP services.</li>
<li>Have replication and ldaps ports peered (open) between clusters.</li>
</ul>
<p>Consider the <a href="../deployK8s-AWS/">EKS Peering Config</a> example if you want to test this.</p>
<h4 id="using-external-dns-names">Using External DNS Names<a class="headerlink" href="#using-external-dns-names" title="Permanent link"> </a></h4>
<p><img alt="pd-multi-dns-diagrams" src="../../images/pd-multi-dns-diagram.png" /></p>
<p><code>20-kustomize/09-multi-k8s-pingdirectory/03-multi-cluster-dns</code></p>
<p>This example uses <a href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services">Headless Services</a> instead of regular clusterIp services. This is necessary in a VPC-peered environment because typically the route-tables and IP ranges you've peered correspond to container IP addresses, not service addresses.</p>
<p>If you were to use clusterIp addresses, the instances might, unexpectedly, not have network connectivity to each other.</p>
<p>The headless services use externalDNS to dynamically add records to the DNS provider (example, Route53)</p>
<p>Because this example requires more care, you should sift through the yamls to understand what is going on.</p>
<p>When the example is stood up, you'll see logs similar to:</p>
<p><img alt="pd-multi-dns-logs" src="../../images/pd-multi-dns-logs.png" /></p>
<h3 id="without-vpc-peering">Without VPC Peering<a class="headerlink" href="#without-vpc-peering" title="Permanent link"> </a></h3>
<p>Some organizations don't allow VPC peering or similar networking functions, or there might be no way to create external hostnames on clusterIp services. Here are some examples that may help.</p>
<h4 id="using-nodeports">Using NodePorts<a class="headerlink" href="#using-nodeports" title="Permanent link"> </a></h4>
<p>In a scenario where you don't have VPC peering or must create external DNS names manually, it might be beneficial to use NodePorts.</p>
<p>To use NodePorts:</p>
<ol>
<li>Use the <code>20-kustomize/09-multi-k8s-pingdirectory/03-multi-cluster-dns</code> example as reference</li>
<li>Make the pod-selector services NodePort services instead of clusterIp.</li>
<li>Optionally, remove the external name and create a routable dns name.</li>
</ol>
<p>If these names are being manually, then create the services and assign names before starting the statefulset.</p>
<h3 id="single-load-balancer">Single Load Balancer<a class="headerlink" href="#single-load-balancer" title="Permanent link"> </a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The following examples are for extremely constrained environments where traffic must go out through an external load balancer. For many purposes, these can be considered deprecated. Avoid doing replication through load balancers when possible.</p>
</div>
<p>The following diagram shows how you can use a single load balancer.</p>
<p><img alt="Single Load Balancer" src="../../images/multi-k8s-cluster-pingdirectory-single-lb.png" /></p>
<p>Advantages:</p>
<ul>
<li>Decreased cost of a single load balancer</li>
<li>Single IP required</li>
<li>Easier DNS management<ul>
<li>Wildcard DNS domain</li>
<li>Or separate hosts pointing to load balancer</li>
</ul>
</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>More port mapping requirements</li>
<li>Many external ports to manage and track</li>
</ul>
<h3 id="multiple-load-balancers">Multiple Load Balancers<a class="headerlink" href="#multiple-load-balancers" title="Permanent link"> </a></h3>
<p>The following diagram shows how you can use muliple load balancers.</p>
<p><img alt="Multiple Load Balancers" src="../../images/multi-k8s-cluster-pingdirectory-multi-lb.png" /></p>
<p>Advantages:</p>
<ul>
<li>Use the same well-known port, such as 1636/8989</li>
<li>Separate IP addresses per instance</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>DNS management<ul>
<li>Separate hostname required per instance</li>
</ul>
</li>
</ul>
<h2 id="statefulset-pod-services"><code>StatefulSet</code> Pod Services<a class="headerlink" href="#statefulset-pod-services" title="Permanent link"> </a></h2>
<p>The <code>StatefulSet</code> service manages stateful objects for each pod.</p>
<p>The following is an example <code>StatefulSet</code> service configuration for one pod:</p>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pingdirectory-0-service</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">statefulset.kubernetes.io/pod-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pingdirectory-0</span><span class="w"></span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8600</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8600</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ldaps</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8700</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8700</span><span class="w"></span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repl</span><span class="w"></span>
</code></pre></div>
<h2 id="additional-kubernetes-resources-required">Additional Kubernetes Resources Required<a class="headerlink" href="#additional-kubernetes-resources-required" title="Permanent link"> </a></h2>
<p>In addition to the <code>StatefulSet</code>, other resources are required to properly map the load balancers to the
pods. The following diagram shows each of those resources.</p>
<p><img alt="K8S Required Resources" src="../../images/multi-k8s-cluster-pingdirectory-resources.png" /></p>
<h3 id="dns">DNS<a class="headerlink" href="#dns" title="Permanent link"> </a></h3>
<p>A DNS entry is required at the load balancer to direct a wildcard domain or individual hostname
to the load balancer created by the NGINX Ingress Service or Controller.  For AWS, this can simply be an <code>A record</code> alias for each host or a wildcard <code>A record</code> for any host in that domain.</p>
<h3 id="nginx-ingress-service-and-controller">NGINX Ingress Service and Controller<a class="headerlink" href="#nginx-ingress-service-and-controller" title="Permanent link"> </a></h3>
<p>Several components map the ports from the external load balancer through the NGINX Service and Controller:</p>
<ul>
<li>External load balancer</li>
</ul>
<p>Provides an external IP and obtains definitions from the NGINX Ingress Service.</p>
<ul>
<li>NGINX Ingress Service</li>
</ul>
<p>Maps all port ranges (SEED_LDAPS_PORT, SEED_REPLICATION_PORT) to the same target port range.</p>
<ul>
<li>NGINX Ingress Controller</li>
</ul>
<p>Maps all port ranges to stateful set pods.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Typically, the NGINX Service and TCP services require additional namespace access, <code>ingress-nginx-public</code>. Any additional applications using this service or controller generally requires additional privileges to manage this resource. For more information, see the <em>NGINX TCP services</em> topic.</p>
</div>
<p>The following is an example NGINX Service configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx-public</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx-public</span><span class="w"></span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">service.beta.kubernetes.io/aws-load-balancer-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nlb</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx-public</span><span class="w"></span>
<span class="w">  </span><span class="nt">externalTrafficPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Local</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">load-balancer</span><span class="w"></span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1443</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ldaps-pingdiretory-0</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8600</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8600</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ldaps-pingdiretory-1</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8601</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8601</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ldaps-pingdiretory-2</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8602</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8602</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repl-pingdiretory-0</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8700</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8700</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repl-pingdiretory-1</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8701</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8701</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repl-pingdiretory-2</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8702</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8702</span><span class="w"></span>
</code></pre></div>
<h3 id="nginx-tcp-services">NGINX TCP Services<a class="headerlink" href="#nginx-tcp-services" title="Permanent link"> </a></h3>
<p>The ConfigMap for TCP services (<code>tcp-services</code>) provides the mappings from the target ports on the NGINX Controller to the associated pod service.</p>
<blockquote>
<p>You must replace the variable <code>${PING_IDENTITY_K8S_NAMESPACE}</code> with the namespace that your <code>StatefulSet</code> and Services are deployed into.</p>
</blockquote>
<p>The following is an example of the ConfigMap for the NGINX TCP services configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp-services</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx-public</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">app.kubernetes.io/role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx-public</span><span class="w"></span>
<span class="nt">data</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">8600</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${PING_IDENTITY_K8S_NAMESPACE}/pingdirectory-0-service:8600&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">8601</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${PING_IDENTITY_K8S_NAMESPACE}/pingdirectory-1-service:8601&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">8602</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${PING_IDENTITY_K8S_NAMESPACE}/pingdirectory-2-service:8602&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">8700</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${PING_IDENTITY_K8S_NAMESPACE}/pingdirectory-0-service:8700&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">8701</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${PING_IDENTITY_K8S_NAMESPACE}/pingdirectory-1-service:8701&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">8702</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${PING_IDENTITY_K8S_NAMESPACE}/pingdirectory-2-service:8702&quot;</span><span class="w"></span>
</code></pre></div>
<h2 id="deployment-example">Deployment Example<a class="headerlink" href="#deployment-example" title="Permanent link"> </a></h2>
<p>The examples in <code>20-kustomize/05-multi-k8s-cluster-pingdirectory</code> create an
example deployment across two clusters in AWS EKS:</p>
<ul>
<li>us-east-2 (SEED Cluster)</li>
<li>eu-west-1</li>
</ul>
<p>Deploy the NGINX services and ConfigMap for the example.</p>
<p>This allows the services to be reached by the NGINX controller with an AWS Network Load Balancer (nlb).  You must run these with an AWS/Kubernetes profile allowing for application into the <code>ingress-nginx-public</code> namespace.  Also, be aware that there might already be other definitions found.  You might need to merge.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f nginx-service.yaml
kubectl apply -f nginx-tcp-services.yaml
</code></pre></div>
<p>The <code>cluster.sh</code> script creates the .yaml necessary to deploy a set of PingDirectory instances in each cluster and replication between.</p>
<div class="highlight"><pre><span></span><code>Usage: cluster.sh OPERATION <span class="o">{</span>options<span class="o">}</span>
  where OPERATION <span class="k">in</span>:
      create
      apply
      delete

  where options <span class="k">in</span>:
      --cluster <span class="o">{</span>cluster<span class="o">}</span>  - Cluster name used to identify different
                             env_vars.pingdirecory files

      --context <span class="o">{</span>context<span class="o">}</span>  - Name of Kubernetes context.
                                Defaults to current context:
                                jsmith.ping-dev-aws-us-east-2

      -d,--dry-run         - Provides the commands

Example:
    cluster.sh create --cluster us-east-2
</code></pre></div>
<h3 id="creating-yaml-for-us-east-2">Creating .yaml for us-east-2<a class="headerlink" href="#creating-yaml-for-us-east-2" title="Permanent link"> </a></h3>
<ol>
<li>
<p>Replace <code>your-cluster-name</code> with the name you are using.  Using the cluster name
<code>us-east-2</code> the script generates a .yaml using kustomize, with the files:</p>
<ul>
<li><code>multi-cluster</code><ul>
<li><code>kustomization.yaml</code></li>
<li><code>pingdirectory-service-clusterip.yaml</code></li>
<li><code>env_vars.pingdirectory</code> (built from env_vars.pingdirectory.multi-cluster and us-east-2)</li>
</ul>
</li>
<li><code>base</code><ul>
<li><code>kustomization.yaml</code></li>
<li><code>https://github.com/pingidentity/pingidentity-devops-getting-started/20-kustomize/03-replicated-pingdirectory</code></li>
<li><code>env_vars.pingdirectory</code></li>
<li><code>limits.yaml</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>./cluster.sh delete <span class="se">\</span>
  --cluster us-east-2 <span class="se">\</span>
  --context &lt;your-cluster-name&gt; <span class="se">\</span>
  --dry-run
</code></pre></div>
<p>This creates a .yaml called <code>ouptut-us-east-2.yaml</code>.</p>
</li>
<li>
<p>Ensure that your <code>devops-secret</code> and <code>tls-secret</code> are created.</p>
<div class="highlight"><pre><span></span><code>ping-devops generate devops-secret <span class="p">|</span> kubectl apply -f -
ping-devops generate tls-secret ping-devops.com <span class="p">|</span> kubectl create -f -
</code></pre></div>
</li>
<li>
<p>Create the instances using the generated <code>output-us-east-2.yaml</code>.</p>
<div class="highlight"><pre><span></span><code>kubectl create -f output-us-east-2.yaml
</code></pre></div>
</li>
</ol>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../deployHelm/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Deploy with Ping Identity Helm Charts" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Deploy with Ping Identity Helm Charts
            </div>
          </div>
        </a>
      
      
        
        <a href="../deployK8sGeneral/" class="md-footer__link md-footer__link--next" aria-label="Next: Introduction" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Introduction
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
       Copyright 2021 Ping Identity
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "instant"], "search": "../../assets/javascripts/workers/search.b028fd86.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f758a944.min.js"></script>
      
    
  </body>
</html>